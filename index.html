<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <title>Recipe Box</title>
    <!--Artist: Hopstarter-->
    <!--http://creativecommons.org/licenses/by-nc-nd/4.0/legalcode-->
    <!--http://www.iconarchive.com/show/sleek-xp-basic-icons-by-hopstarter/Document-Write-icon.html-->
    <link rel="icon" href="Hopstarter-Sleek-Xp-Basic-Document-Write.ico" type="image/x-icon" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css">    
    <link href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="main.css">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="description" content="Zipline: Build a Recipe Box, A data visualization development projects.">
    <meta name="keywords" content="fcc, html, css, recipe box, javascript">
    <script src="react.js"></script>
    <script src="react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  </head>
  <body>
    <div id="contentText" ></div>
    <script type="text/babel">
      var Modal = React.createClass({
          
          closeModal: function( e ) {     
              this.props.displayModal();                                 
          },
          
          createRecipe: function( event ) {
              event.preventDefault( event );
              
              // 1. Collect data from form
              var recipeData = {
                recipeName: this.refs.recipeName.value,
                ingredients: this.refs.recipeDesc.value
                                               .split(",")  
                                               .map(function( ingredient ){
                                                   return ingredient.trim();
                                               })                                               
              };
              
              // 2. Pass data to App
              this.props.addRecipe( recipeData );
              
              // 3. Reset Form
              this.refs.recipeForm.reset();
              
          },
          
          render: function() {
              var classes;
              if ( this.props.willDisplayModal ){
                  classes = "modal_container";
              } else {
                  classes = "modal_container showModal";
              }

              console.log( "Show modal : " + this.props.willDisplayModal );
              
              return (
                  <div id="myModal" className={classes} >
                    <div className="modal_content">
                      <div className="modal_header">
                        <span onClick={this.closeModal} className="modal_close">x</span> 
                        <h4>Add Recipe</h4>
                      </div>
                      <div className="modal_body">
                        <form onSubmit={this.createRecipe} ref="recipeForm">
                          <div className="form-group">
                            <label for="recipeName">Recipe Name</label>
                            <input type="text" className="form-control" id="recipeName"  placeholder="Enter your recipe name" ref="recipeName" />
                          </div>
                          <div className="form-group">
                            <label for="ingredients">Ingredients</label>
                            <textarea type="text" className="form-control" id="ingredients" placeholder="Enter ingredients separated by commas ex. coffee, sugar, cream" ref="recipeDesc"></textarea>
                          </div>
                          <button id="submit" className="btn pull-right" type="submit">Create Recipe</button>
                          <button id="myBtn" className="btn pull-right" type="button" onClick={this.closeModal}>Close</button>                         
                          <div className="clearfix"></div>
                        </form>
                      </div>
                      <div className="modal_footer">                                
                                                              
                      </div>                     
                    </div>                                 
                  </div>
              )
          }
      });
      
      var EditModal = React.createClass({
          getInitialState: function() {
              return {
                  isEditModalOpen: false
              }
          },
          
          editRecipe: function( event ) {
              event.preventDefault( event );
              
              // 1. Collect data from form
              var recipeData = {
                recipeName: this.refs.recipeName.value,
                ingredients: this.refs.recipeDesc.value
                                               .split(",")  
                                               .map(function( ingredient ){
                                                   return ingredient.trim();
                                               })                                               
              };
              
              // 2. Pass data to App
              this.props.addRecipe( recipeData );
              
              // 3. Reset Form
              this.refs.recipeForm.reset();
              
          },
          
          render: function() {
              
              var classes;
              if ( this.props.isEditModalOpen ){
                  classes = "modal_container";
              } else {
                  classes = "modal_container edit_modal";
              }
              
              return (
                  <div id="myModal" className={classes} >
                    <div className="modal_content">
                      <div className="modal_header">
                        <span onClick={this.closeModal} className="modal_close">x</span> 
                        <h4>Edit Recipe</h4>
                      </div>
                      <div className="modal_body">
                        <form onSubmit={this.createRecipe} ref="recipeForm">
                          <div className="form-group">
                            <label for="recipeName">Recipe Name</label>
                            <input type="text" className="form-control" id="recipeName"  placeholder="Enter your recipe name" ref="recipeName" />
                          </div>
                          <div className="form-group">
                            <label for="ingredients">Ingredients</label>
                            <textarea type="text" className="form-control" id="ingredients" placeholder="Enter ingredients separated by commas ex. coffee, sugar, cream" ref="recipeDesc"></textarea>
                          </div>
                          <button id="submit" className="btn pull-right" type="submit" onclick={this.displayModal}>Edit Recipe</button>
                          <button id="myBtn" className="btn pull-right" type="button" onClick={this.closeModal}>Close</button>                         
                          <div className="clearfix"></div>
                        </form>
                      </div>
                      <div className="modal_footer">                                
                                                              
                      </div>                     
                    </div>                                 
                  </div>
              )
          }
      });
      
      var List = React.createClass({
          getInitialState: function() {
              return {
                  isPanelOpen: false,
                  class: "panel closed",
                  listGroup: "list-group-item accordion",
                  isEditModalOpen: false
              }
          },
          _togglePanel: function(e) {
              if( !this.state.isPanelOpen) {
                  this.setState({
                      isPanelOpen: true,
                      class: "panel open", 
                      listGroup: "list-group-item accordion active"
                  });
              } else {
                  this.setState({
                      isPanelOpen: false,
                      class: "panel closed",
                      listGroup: "list-group-item accordion"
                  });
              }
              
          },
          _removeRecipe: function( idx, e ){
              console.log( "remove element" );
              
              this.props.removeRecipe(idx);
          },
          _renderIngredients: function( ingredient, idx ){
            return (
                <li key={idx}>{ingredient}</li>
            )
          },
          _editRecipe: function(idx, event) {
              
              this.setState({
                  isEditModalOpen: true
              });
          },
          render: function() {
              console.log( this.props.idx );
              
              return (
                  <div>
                      <EditModal isEditModalOpen={this.state.isEditModalOpen} />
                      <button type="button" className={this.state.listGroup} onClick={this._togglePanel}>
                          <span className="glyphicon glyphicon-list-alt" aria-hidden="true"></span>{this.props.recipe.recipeName}
                      </button>
                      <div className={this.state.class}>
                          <h4>{this.props.recipe.recipeName}</h4>
                          <ul>
                              {this.props.recipe.ingredients.map(this._renderIngredients)}
                          </ul>
                          <button className="btn" onClick={this._removeRecipe.bind(this, this.props.idx)} type="button">Delete</button>
                          <button className="btn" onClick={this._editRecipe.bind(this, this.props.idx)} type="button">Edit</button>
                      </div>
                      
                      <pre>
                          {JSON.stringify(this.state, null, 2)}
                      </pre>
                      
                  </div>
                 
              )
          }
      });
      
      var Button = React.createClass({
          getModal: function(e) {
              this.props.setModal();
          },
          render: function(){
              
              return (
                  <button id="myBtn" className="btn" type="button" onClick={this.idp}>{this.props.buttonName}</button>
              )            
          }
      });
      
      var App = React.createClass({
        getInitialState: function() {
          return {
              showModal: false,
              recipes: [
                  {recipeName: "garlic chicken", ingredients: ["chicken", "garlic", "onion", "black pepper"]}, 
                  {recipeName: "Spaghetti", ingredients: ["Noodles", "Tomato sauce", "Meatballs"]}
              ],
             
          };
        },
        _addRecipe: function( recipe ) {
            var recipes;
            this.state.recipes.push( recipe );
            this.setState({
                recipes: this.state.recipes
            });
        },
        removeRecipe: function( idx ){
            var recipesData = this.state.recipes.slice();
            recipesData.splice( idx, 1);
            this.setState({
                recipes: recipesData
            });
        },
        componentDidMount: function() {
                   
        }, 
        componentWillUnmount: function() {
            
        },
        displayModal: function() {
           
           this.setState({
               showModal: !this.state.showModal
           });

            console.log( this.state );
            
        },
        _togglePanel: function(e) {
            console.log(this);
        },
        render: function() {
          var removeRecipe = this.removeRecipe
          
          return (
           <div>
               <Modal displayModal={this.displayModal} addRecipe={this._addRecipe}  willDisplayModal={this.state.showModal} />
              <div className="col-md-12">
                <header className="text-center">
                  <h1>Recipe Box</h1>
                </header>
                <div className="container col-md-12">
                  <div className="list-group">
                    {
                        this.state.recipes.map(function( recipe, idx ){
                            return <List recipe={recipe} removeRecipe={removeRecipe} key={idx} idx={idx} />
                        })
                    }                  
                  </div>
                  
                  <button id="myBtn" className="btn" type="button" onClick={this.displayModal}>Add Recipe</button>
                </div>     
              </div> 
              <pre>
                  {JSON.stringify(this.state, null, 2)}
              </pre>
           </div>            
          )
        }
      });
      
      ReactDOM.render( <App  />, document.getElementById("contentText") );
      
    </script>
  </body>
</html>